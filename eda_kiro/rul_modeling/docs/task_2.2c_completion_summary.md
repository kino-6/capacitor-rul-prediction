# Task 2.2c 完了サマリー: One-Class SVM v2（波形特性のみ）

**完了日**: 2026-01-17  
**タスク**: Task 2.2c - One-Class SVM v2による異常検知（効率系特徴量除外版）

---

## 🎯 実装内容

### アプローチ

効率系特徴量を除外し、**波形特性のみ**で異常検知を実施。

**理由**:
- 前回のOne-Class SVM v1で、効率系特徴量が中期に異常ピークを示すことが判明
- Response Efficiency: 初期3.4 → 中期1760 → 後期1.1（U字型パターン）
- 物理的に不可能（コンデンサは劣化から回復しない）
- 効率変化は劣化の**結果**であり、**予測指標**ではない

### 使用特徴量（7個の波形特性のみ）

1. **waveform_correlation**: VLとVOの波形相関（劣化で1.0に近づく）
2. **vo_variability**: VO波形の変動性（劣化で増加）
3. **vl_variability**: VL波形の変動性（劣化で増加）
4. **response_delay**: 応答遅延
5. **response_delay_normalized**: 正規化応答遅延
6. **residual_energy_ratio**: 残差エネルギー比（劣化で増加）
7. **vo_complexity**: VO波形の複雑度

### 除外した特徴量（効率系）

1. **response_efficiency**: 中期に異常ピーク（1760）
2. **voltage_ratio**: 中期に異常ピーク（47）
3. **peak_voltage_ratio**: voltage_ratioと同様
4. **rms_voltage_ratio**: voltage_ratioと同様

### 学習データ

- **正常データ**: 初期1-10サイクル（80サンプル）
- **理由**: 製品特性として初期サイクルは必ず正常
- **モデル**: One-Class SVM（RBFカーネル、nu=0.1）

---

## 📊 結果

### 異常検出率

- **全体**: 91.9%（1471/1600サンプル）
- **Cycles 1-50**: 77.0%（初期の一部を正常判定）
- **Cycles 51-100**: 100.0%（完全に異常検出）
- **Cycles 101-150**: 91.8%
- **Cycles 151-200**: 99.0%（ほぼ完全に異常検出）

### 波形特性の変化（正常 vs 異常）

| 特徴量 | 正常平均 | 異常平均 | 変化率 |
|--------|----------|----------|--------|
| waveform_correlation | 0.77 | 0.91 | +18.6% |
| vo_variability | 0.23 | 0.49 | +110.2% |
| vl_variability | 0.25 | 0.73 | +194.4% |
| residual_energy_ratio | 0.0017 | 0.0117 | +582.8% |

### 効率系特徴量（検証用、モデルには不使用）

| 特徴量 | 正常平均 | 異常平均 | 変化率 |
|--------|----------|----------|--------|
| response_efficiency | 5.3 | 1437.0 | +26,886% |
| voltage_ratio | 1.3 | 41.3 | +3,009% |

---

## ✅ 物理的妥当性の検証

### 1. 初期サイクルの扱い

- ✅ 初期1-10サイクルを正常として学習
- ✅ Cycles 1-50で77.0%異常検出（初期の一部を正常判定）
- ✅ Cycle 11以降はほぼ全て異常検出

### 2. 劣化パターンの単調性

- ✅ Waveform Correlation: 単調増加（0.77 → 0.91）
- ✅ VO/VL Variability: 単調増加（不安定化）
- ✅ Residual Energy Ratio: 単調増加（線形関係からの逸脱）
- ✅ U字型パターンなし（物理的に妥当）

### 3. 中期サイクルの扱い

- ✅ Cycles 51-100: 100%異常検出
- ✅ 効率系特徴量の異常ピークを回避
- ✅ 波形特性の変化を正しく検出

---

## 🔍 3つのアプローチの比較

| アプローチ | 異常検出率 | 物理的妥当性 | 問題点 |
|-----------|-----------|-------------|--------|
| Isolation Forest | 10.0% | ❌ 低い | 初期高効率を異常判定 |
| One-Class SVM v1 | 93.4% | ❌ 低い | 中期を正常判定（U字型） |
| **One-Class SVM v2** | **91.9%** | **✅ 高い** | **なし** |

### 推奨アプローチ

**One-Class SVM v2（波形特性のみ）**を推奨

**理由**:
1. 物理的に妥当な劣化パターンを検出
2. 効率系特徴量の異常ピークを回避
3. 波形特性のみで十分な異常検知が可能
4. 単調な劣化パターン（回復なし）

---

## 📁 出力ファイル

### モデルファイル
- `output/models_v3/one_class_svm_v2.pkl` - 学習済みモデル
- `output/models_v3/one_class_svm_v2_scaler.pkl` - 特徴量スケーラー
- `output/models_v3/one_class_svm_v2_features.txt` - 使用特徴量リスト

### 結果ファイル
- `output/anomaly_detection/one_class_svm_v2_results.csv` - 異常検知結果（1600サンプル）
- `output/anomaly_detection/one_class_svm_v2_results.png` - 可視化結果

### 分析ドキュメント
- `output/anomaly_detection/anomaly_detection_comparison.md` - 3つのアプローチの比較分析

---

## 💡 重要な発見

### 効率系特徴量は劣化の結果

**Response Efficiencyの推移**:
- 初期（1-10）: 3.4
- 中期（50-60）: 1760.58（異常な高値）
- 後期（190-200）: 1.1

**結論**:
- 効率変化は劣化の**結果**であり、**予測指標**ではない
- 中期の異常ピークは物理的に不可能（劣化から回復しない）
- 効率系特徴量は検証用として有用だが、学習には不適切

### 波形特性のみで十分

**波形特性の変化**:
- Waveform Correlation: 波形の単純化（1.0に近づく）
- VO/VL Variability: 応答の不安定化（増加）
- Residual Energy Ratio: 線形関係からの逸脱（増加）

**結論**:
- 波形特性のみで物理的に妥当な異常検知が可能
- 7個の波形特性で91.9%の異常検出率
- 効率系特徴量なしでも十分な性能

---

## 🎯 次のステップ

### Phase 2の残りタスク

1. **Task 2.3**: クラスタリングによる劣化パターン分類
   - K-meansまたはDBSCANで劣化パターンを分類
   - 各クラスタの特徴分析

2. **Task 2.4**: 異常検知結果の妥当性検証
   - 異常サイクルの波形確認
   - 物理的解釈の検証
   - False Positive/Negative分析

### Phase 3への準備

- 劣化度の定義（0-1スケール）
- 劣化度予測モデルの構築
- 次サイクル応答性の予測

---

## 📝 まとめ

Task 2.2cでは、効率系特徴量を除外し、波形特性のみでOne-Class SVM v2を構築しました。

**主な成果**:
- ✅ 物理的に妥当な異常検知（91.9%検出率）
- ✅ 効率系特徴量の問題を解決（中期ピーク回避）
- ✅ 波形特性のみで十分な性能を確認
- ✅ 3つのアプローチを比較分析
- ✅ One-Class SVM v2を推奨アプローチとして特定

**重要な発見**:
- 効率変化は劣化の結果であり、予測指標ではない
- 波形特性（correlation, variability, complexity）が真の劣化指標
- 初期サイクル（1-10）を正常として学習することで物理的に妥当な検出が可能

次はTask 2.3（クラスタリング）またはTask 2.4（妥当性検証）に進みます。
