# RUL予測モデル開発 - 要件定義

## 📋 プロジェクト概要

ES12データセット（およびES10, ES14）を用いて、コンデンサの劣化状態を検知し、残存耐用寿命（RUL）を予測する機械学習モデルを構築する。

## 🎯 ビジネス目標

1. コンデンサの異常状態を早期に検知する
2. 残存耐用寿命を精度良く予測する
3. 保守計画の最適化に貢献する

## 👥 ユーザーストーリー

### US-1: 特徴量抽出
**As a** データサイエンティスト  
**I want to** ES12データから各サイクルの特徴量を抽出する  
**So that** モデル学習に使用できるデータセットを構築できる

**受け入れ基準**:
- [ ] VL/VOの基本統計量（平均、標準偏差、範囲など）を抽出できる
- [ ] 劣化指標（電圧比、応答効率など）を計算できる
- [ ] 履歴特徴量（過去Nサイクルの統計）を生成できる
- [ ] 全8個のコンデンサ、各約200サイクルから特徴量を抽出できる
- [ ] 抽出した特徴量をCSV形式で保存できる

### US-2: ラベル生成
**As a** データサイエンティスト  
**I want to** 各サイクルに対してラベル（Normal/Abnormal, RUL）を生成する  
**So that** 教師あり学習を実施できる

**受け入れ基準**:
- [ ] Primary Model用の異常検知ラベル（0: Normal, 1: Abnormal）を生成できる
- [ ] Secondary Model用のRUL値（残りサイクル数）を計算できる
- [ ] ラベリング戦略（閾値ベース、サイクル番号ベースなど）を選択できる
- [ ] ラベルをCSV形式で保存できる

### US-3: データ分割
**As a** データサイエンティスト  
**I want to** データをTrain/Val/Testに分割する  
**So that** モデルの汎化性能を適切に評価できる

**受け入れ基準**:
- [ ] ハイブリッド分割戦略を実装できる（Train: C1-C5の1-150サイクル、Val: C6の1-150サイクル、Test: C7-C8の1-200サイクル）
- [ ] 時系列データの特性を考慮した分割ができる
- [ ] 分割後のデータセットを保存できる

### US-4: Primary Model（異常検知）
**As a** データサイエンティスト  
**I want to** コンデンサの状態を正常/異常に分類するモデルを構築する  
**So that** 異常状態を早期に検知できる

**受け入れ基準**:
- [ ] Random Forest Classifierをベースラインとして実装できる
- [ ] 学習・予測パイプラインを構築できる
- [ ] Accuracy, Precision, Recall, F1-Score, ROC-AUCで評価できる
- [ ] 特徴量重要度を可視化できる
- [ ] モデルを保存・読み込みできる

### US-5: Secondary Model（RUL予測）
**As a** データサイエンティスト  
**I want to** 残存耐用寿命を予測するモデルを構築する  
**So that** 保守計画を最適化できる

**受け入れ基準**:
- [ ] Random Forest Regressorをベースラインとして実装できる
- [ ] Primary Modelの出力を考慮した予測ができる
- [ ] MAE, RMSE, R², MAPEで評価できる
- [ ] 予測結果を可視化できる（実測値 vs 予測値）
- [ ] モデルを保存・読み込みできる

### US-6: モデル評価
**As a** データサイエンティスト  
**I want to** モデルの性能を包括的に評価する  
**So that** モデルの改善点を特定できる

**受け入れ基準**:
- [ ] Train/Val/Testセットでの性能を比較できる
- [ ] 混同行列、ROC曲線を可視化できる（Primary Model）
- [ ] 残差プロット、予測誤差分布を可視化できる（Secondary Model）
- [ ] 評価レポートを自動生成できる

### US-7: モデル改善
**As a** データサイエンティスト  
**I want to** モデルの性能を向上させる  
**So that** より精度の高い予測を実現できる

**受け入れ基準**:
- [ ] ハイパーパラメータチューニング（Grid Search, Random Search）を実施できる
- [ ] 複数のアルゴリズム（XGBoost, LightGBM, LSTM）を試せる
- [ ] 特徴量エンジニアリング（新規特徴量の追加）ができる
- [ ] アンサンブル手法を適用できる

## 🔧 技術要件

### データ要件
- **入力データ**: ES12.mat（1.2GB）
- **データ形式**: MATLAB v7.3 HDF5
- **コンデンサ数**: 8個（ES12C1～ES12C8）
- **サイクル数**: 各約200サイクル
- **時系列データ**: VL（入力電圧）、VO（出力電圧）、各約3000ポイント/サイクル

### 特徴量要件
- **基本統計量**: 平均、標準偏差、最小値、最大値、範囲、中央値、四分位数
- **劣化指標**: 電圧比、応答効率、信号減衰
- **時系列特徴**: トレンド、変動係数
- **履歴特徴**: 過去Nサイクルの統計、劣化率
- **特徴量数**: サイクルあたり20-30特徴量

### モデル要件
- **Primary Model**: Binary Classification（Normal/Abnormal）
- **Secondary Model**: Regression（RUL予測）
- **ベースラインアルゴリズム**: Random Forest
- **評価指標**: 
  - Primary: Accuracy, Precision, Recall, F1-Score, ROC-AUC
  - Secondary: MAE, RMSE, R², MAPE

### 性能要件
- **Primary Model**: F1-Score ≥ 0.80（目標）
- **Secondary Model**: MAPE ≤ 20%（目標）
- **処理時間**: 特徴量抽出 ≤ 10分、モデル学習 ≤ 5分

### 出力要件
- **特徴量データ**: CSV形式
- **モデルファイル**: pickle形式
- **評価レポート**: Markdown + 可視化画像（PNG）
- **予測結果**: CSV形式

## 📊 データ分割戦略

### ハイブリッド分割（推奨）

```
Train: C1-C5 の サイクル 1-150  (5個 × 150サイクル = 750サンプル)
Val:   C6 の サイクル 1-150     (1個 × 150サイクル = 150サンプル)
Test:  C7-C8 の サイクル 1-200  (2個 × 200サイクル = 400サンプル)
```

**利点**:
- コンデンサとサイクルの両方を考慮
- 未知のコンデンサに対する汎化性能を評価
- 十分なデータ量を確保

## 🎯 成功基準

### Phase 1: データ準備（完了条件）
- [ ] 全コンデンサから特徴量を抽出完了
- [ ] ラベル生成完了
- [ ] Train/Val/Test分割完了
- [ ] データセットの品質確認完了

### Phase 2: ベースラインモデル（完了条件）
- [ ] Primary Modelの学習・評価完了
- [ ] Secondary Modelの学習・評価完了
- [ ] 評価レポート作成完了
- [ ] ベースライン性能の記録完了

### Phase 3: モデル改善（完了条件）
- [ ] ハイパーパラメータチューニング完了
- [ ] 複数アルゴリズムの比較完了
- [ ] 最終モデルの選定完了
- [ ] 最終評価レポート作成完了

## 🚫 非機能要件

### コード品質
- [ ] PEP 8準拠
- [ ] 型ヒント使用
- [ ] Docstring記述
- [ ] ユニットテスト（カバレッジ ≥ 80%）

### 再現性
- [ ] ランダムシード固定
- [ ] 環境設定の文書化（pyproject.toml）
- [ ] データバージョン管理

### 保守性
- [ ] モジュール化された設計
- [ ] 設定ファイルによるパラメータ管理
- [ ] ログ出力

## 📅 マイルストーン

| Phase | 期間 | 成果物 |
|-------|------|--------|
| Phase 1: データ準備 | Week 1 | 特徴量データセット、ラベル |
| Phase 2: ベースライン | Week 2 | ベースラインモデル、評価レポート |
| Phase 3: モデル改善 | Week 3-4 | 最終モデル、最終評価レポート |

## 🔗 参考資料

- [RULモデル設計書](../../docs/rul_model_design.md)
- [EDA結果](../../../output/large_gap_similar_vl_dissimilar_vo/)
- [ES12データ構造ガイド](../../../docs/es12_data_structure_guide.md)

---

**作成日**: 2026-01-15
**最終更新**: 2026-01-15
