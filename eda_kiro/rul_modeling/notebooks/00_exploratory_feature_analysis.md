# Phase 0: 探索的特徴量分析

## 🎯 目的

モデル実装前に、特徴量とRULの相関を確認し、有効な特徴量を特定する。

## 📋 分析ステップ

### Step 1: 少数サイクルで特徴量抽出を試す

```python
# 1つのコンデンサ（ES12C1）の最初の10サイクルで試す
- サイクル1-10のVL/VOデータを読み込み
- 26特徴量を抽出
- DataFrameで確認
```

**確認ポイント**:
- 特徴量が正しく計算されているか
- 欠損値やNaNがないか
- 値の範囲が妥当か

### Step 2: 特徴量とサイクル番号の関係を可視化

```python
# 1つのコンデンサの全サイクル（200サイクル）で特徴量を抽出
- 各特徴量 vs サイクル番号のプロット
- トレンドの確認
```

**確認ポイント**:
- 劣化に伴って変化する特徴量はどれか
- 一定値のままの特徴量はどれか
- ノイズが多い特徴量はどれか

### Step 3: 特徴量とRULの相関分析

```python
# RUL = 200 - cycle_number として計算
- 各特徴量とRULの相関係数を計算
- 相関係数の高い順にソート
- ヒートマップで可視化
```

**期待される結果**:
```
特徴量                      相関係数
voltage_ratio              -0.85  # 強い負の相関（劣化で増加）
degradation_rate           -0.82
cycle_normalized           -1.00  # 完全な負の相関（定義上）
vo_mean                     0.45
vl_mean                     0.12  # 弱い相関
...
```

### Step 4: 複数コンデンサでの一貫性確認

```python
# 全8個のコンデンサで相関係数を計算
- コンデンサごとの相関係数を比較
- 一貫して高い相関を持つ特徴量を特定
```

**確認ポイント**:
- 全コンデンサで一貫して高い相関を持つ特徴量
- コンデンサによって相関が異なる特徴量

### Step 5: 特徴量の重要度ランキング

```python
# 簡単なRandom Forestで特徴量重要度を計算
from sklearn.ensemble import RandomForestRegressor

# 1つのコンデンサで学習
model = RandomForestRegressor(n_estimators=100, random_state=42)
model.fit(X, y_rul)

# 特徴量重要度を可視化
importances = model.feature_importances_
```

**期待される結果**:
```
特徴量                      重要度
cycle_normalized            0.35
voltage_ratio               0.18
degradation_rate            0.12
voltage_ratio_mean_last_5   0.08
...
```

## 📊 分析結果の活用

### 高相関・高重要度の特徴量

これらを**必須特徴量**として残す：
- `cycle_normalized`
- `voltage_ratio`
- `degradation_rate`
- `voltage_ratio_mean_last_5`

### 低相関・低重要度の特徴量

これらは**削除候補**：
- 相関係数 < 0.1
- 特徴量重要度 < 0.01
- 全コンデンサで一貫性がない

### 新規特徴量の候補

EDAの結果から追加を検討：
- `voltage_ratio_change_rate`: 電圧比の変化率（前サイクルとの差分）
- `vo_vl_ratio_std_last_10`: 過去10サイクルの電圧比の標準偏差
- `time_since_threshold`: 電圧比が閾値を超えてからの経過サイクル数

## 🎯 成功基準

Phase 0の完了条件：

- [ ] 特徴量抽出ロジックが正しく動作する
- [ ] 相関係数 > 0.5 の特徴量を5個以上特定
- [ ] 全コンデンサで一貫性のある特徴量を特定
- [ ] 削除候補の特徴量をリストアップ
- [ ] 追加候補の特徴量をリストアップ

## 📝 実装ファイル

```
notebooks/00_exploratory_feature_analysis.ipynb
```

**セクション構成**:
1. データ読み込み
2. 特徴量抽出（少数サイクル）
3. 特徴量とサイクル番号の可視化
4. 相関分析
5. 複数コンデンサでの一貫性確認
6. Random Forestでの重要度分析
7. 結論とアクションアイテム

## 🔗 次のステップ

Phase 0の結果を踏まえて：

1. **有効な特徴量のみ**を使ってデータセット構築
2. ベースラインモデルの学習
3. SHAPでさらに詳細な分析
4. 特徴量エンジニアリング

---

**作成日**: 2026-01-15

まずはこのノートブックで探索的に分析しましょう！
