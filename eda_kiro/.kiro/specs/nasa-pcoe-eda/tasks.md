# 実装計画

- [x] 1. プロジェクト構造とUV環境のセットアップ
  - pyproject.tomlを作成し、全ての依存関係を定義する
  - プロジェクトディレクトリ構造を作成する（src, tests, data, output）
  - README.mdを作成し、プロジェクトの概要とセットアップ手順を記載する
  - pathlibを使用したOS非依存のパス処理ユーティリティを実装する
  - _要件: 1.1, 1.2, 1.3, 1.4, 1.5_

- [x] 1.1 プロパティテストを実装: パス処理のOS独立性
  - **プロパティ1: パス処理のOS独立性**
  - **検証: 要件 1.4**

- [x] 2. データモデルと例外クラスの定義
  - DatasetMetadata, ValidationResult, Stats等のデータクラスを実装する
  - EDAError, DataLoadError等のカスタム例外クラスを実装する
  - 型ヒントを全てのデータモデルに追加する
  - _要件: 2.1, 2.2, 2.3, 2.4, 2.5_

- [x] 3. DataLoaderの実装
  - load_dataset()メソッドを実装し、MATLAB .matファイル形式（ES12.mat）をサポートする
  - scipy.io.loadmatを使用してMATLABファイルを読み込む
  - 読み込んだデータをpandas DataFrameに変換する
  - validate_data()メソッドを実装し、データの整合性を検証する
  - get_metadata()メソッドを実装し、データセット情報を抽出する
  - エラーハンドリングを実装し、破損ファイルや欠落ファイルに対応する
  - _要件: 2.1, 2.2, 2.3, 2.4, 2.5_
  - _データファイル: ../12.CapacitorElectricalStress/ES12.mat_

- [x] 3.1 プロパティテストを実装: データ読み込みの完全性
  - **プロパティ2: データ読み込みの完全性**
  - **検証: 要件 2.3**

- [x] 3.2 プロパティテストを実装: データ検証の一貫性
  - **プロパティ3: データ検証の一貫性**
  - **検証: 要件 2.2**

- [x] 3.3 プロパティテストを実装: エラーハンドリングの堅牢性
  - **プロパティ4: エラーハンドリングの堅牢性**
  - **検証: 要件 2.4**

- [x] 3.4 プロパティテストを実装: データ永続性
  - **プロパティ5: データ永続性**
  - **検証: 要件 2.5**

- [x] 4. StatisticsAnalyzerの実装
  - compute_descriptive_stats()メソッドを実装し、平均、中央値、標準偏差等を計算する
  - analyze_missing_values()メソッドを実装し、欠損値を分析する
  - identify_data_types()メソッドを実装し、各特徴量のデータ型を識別する
  - _要件: 3.1, 3.2, 3.3, 3.4_

- [x] 4.1 プロパティテストを実装: 統計計算の正確性
  - **プロパティ6: 統計計算の正確性**
  - **検証: 要件 3.2**

- [x] 4.2 プロパティテストを実装: 欠損値カウントの正確性
  - **プロパティ7: 欠損値カウントの正確性**
  - **検証: 要件 3.3**

- [x] 4.3 プロパティテストを実装: データ型識別の正確性
  - **プロパティ8: データ型識別の正確性**
  - **検証: 要件 3.4**

- [x] 5. CorrelationAnalyzerの実装
  - compute_correlation_matrix()メソッドを実装し、ペアワイズ相関を計算する
  - identify_high_correlations()メソッドを実装し、強い相関を持つペアを識別する
  - detect_multicollinearity()メソッドを実装し、多重共線性を検出する
  - _要件: 3.5, 9.1, 9.2, 9.4_

- [x] 5.1 プロパティテストを実装: 相関計算の対称性
  - **プロパティ9: 相関計算の対称性**
  - **検証: 要件 3.5**

- [x] 5.2 プロパティテストを実装: 相関の範囲制約
  - **プロパティ18: 相関の範囲制約**
  - **検証: 要件 9.1**

- [x] 5.3 プロパティテストを実装: 強相関識別の閾値一貫性
  - **プロパティ19: 強相関識別の閾値一貫性**
  - **検証: 要件 9.2**

- [x] 6. OutlierDetectorの実装
  - detect_outliers_iqr()メソッドを実装し、IQR法で外れ値を検出する
  - detect_outliers_zscore()メソッドを実装し、Zスコア法で外れ値を検出する
  - summarize_outliers()メソッドを実装し、外れ値の統計を集計する
  - 設定可能な閾値パラメータをサポートする
  - _要件: 5.1, 5.2, 5.4_

- [x] 6.1 プロパティテストを実装: 外れ値検出の閾値依存性
  - **プロパティ11: 外れ値検出の閾値依存性**
  - **検証: 要件 5.4**

- [x] 6.2 プロパティテストを実装: 外れ値カウントの正確性
  - **プロパティ12: 外れ値カウントの正確性**
  - **検証: 要件 5.2**

- [x] 7. TimeSeriesAnalyzerの実装
  - identify_temporal_features()メソッドを実装し、時間ベース特徴量を識別する
  - compute_trends()メソッドを実装し、トレンド統計を計算する
  - detect_seasonality()メソッドを実装し、季節性や周期的パターンを検出する
  - _要件: 6.1, 6.2, 6.4_

- [x] 7.1 プロパティテストを実装: 時間特徴量識別の一貫性
  - **プロパティ13: 時間特徴量識別の一貫性**
  - **検証: 要件 6.1**

- [x] 8. VisualizationEngineの実装
  - japanize-matplotlibを使用して日本語表示を有効化する
  - plot_distributions()メソッドを実装し、ヒストグラムを生成する
  - plot_time_series()メソッドを実装し、時系列プロットを生成する
  - plot_correlation_heatmap()メソッドを実装し、相関ヒートマップを生成する
  - plot_scatter_matrix()メソッドを実装し、散布図行列を生成する
  - 全ての可視化を指定された出力ディレクトリに保存する
  - _要件: 4.1, 4.2, 4.3, 4.4, 4.5, 5.3_

- [x] 8.1 コンデンサ劣化可視化の詳細実装（入力-出力応答性の変化）
  - h5pyを使用してMATLAB v7.3形式のES12.matファイルを正しく読み込む
  - EIS_Data（電気化学インピーダンス分光データ）から各コンデンサ（ES12C1～ES12C8）のデータを抽出する
  - **同一個体への同一入力に対する出力応答の変化を可視化する**：
    - 同じコンデンサに同じ周波数の交流信号を入力した時の応答（インピーダンス、位相）の変化
    - サイクル1、サイクル10、サイクル20...での同一入力に対する出力の比較プロット
    - 応答性の劣化（応答時間の遅延、振幅の減少、位相のずれ）を定量化
  - **容量とESRの劣化トレンドを可視化する**：
    - 各サイクルでの容量値とESR値をプロット（サイクル数 vs 容量、サイクル数 vs ESR）
    - 初期値からの変化率を％で表示（例：容量が初期値の80%に劣化）
    - 劣化速度（変化率/サイクル）を計算して表示
  - **個別コンデンサの劣化パターンを可視化する**：
    - 1つのコンデンサの全サイクルを通した詳細な劣化プロセス
    - 劣化の非線形性（初期は緩やか、後期は急激など）を可視化
    - 故障予兆の検出（急激な変化点の特定）
  - **複数コンデンサの劣化比較**：
    - 8個のコンデンサの劣化速度と劣化パターンの比較
    - 個体差による劣化のばらつきを可視化
    - 最も劣化が早い/遅いコンデンサの特定
  - 各可視化に適切なラベル、凡例、統計情報（R²値、傾き、変化率）を追加する
  - _要件: 4.2, 10.3, 10.4_

- [x] 8.2 プロパティテストを実装: 可視化ファイル生成
  - **プロパティ10: 可視化ファイル生成**
  - **検証: 要件 4.5**

- [x] 9. データ品質評価機能の実装
  - 各特徴量の完全性を評価する機能を実装する
  - 重複レコードを検出する機能を実装する
  - データ型の一貫性を検証する機能を実装する
  - 品質問題の種類と影響範囲を報告する機能を実装する
  - _要件: 8.1, 8.2, 8.3, 8.4_

- [x] 9.1 プロパティテストを実装: 重複検出の正確性
  - **プロパティ16: 重複検出の正確性**
  - **検証: 要件 8.2**

- [x] 9.2 プロパティテストを実装: データ品質問題の報告
  - **プロパティ17: データ品質問題の報告**
  - **検証: 要件 8.4**

- [x] 10. RULFeatureAnalyzerの実装
  - identify_degradation_features()メソッドを実装し、劣化トレンドを示す特徴量を識別する
  - compute_degradation_rates()メソッドを実装し、時間経過に伴う変化率を計算する
  - rank_features_for_rul()メソッドを実装し、RULとの相関でランク付けする
  - visualize_degradation_patterns()メソッドを実装し、劣化パターンを可視化する
  - RUL予測モデル構築に推奨される特徴量リストを生成する
  - _要件: 10.1, 10.2, 10.3, 10.4, 10.5_

- [x] 10.1 プロパティテストを実装: 劣化率の単調性
  - **プロパティ20: 劣化率の単調性**
  - **検証: 要件 10.2**

- [x] 10.2 プロパティテストを実装: RUL特徴量ランキングの順序性
  - **プロパティ21: RUL特徴量ランキングの順序性**
  - **検証: 要件 10.4**

- [x] 11. FaultLevelAnalyzerの実装
  - src/nasa_pcoe_eda/analysis/fault_level.pyファイルを作成する
  - identify_discriminative_features()メソッドを実装し、故障状態を区別できる特徴量を識別する
  - compare_distributions()メソッドを実装し、正常/異常状態の分布を比較する
  - compute_class_separability()メソッドを実装し、クラス間分離度を計算する
  - 故障レベル同定モデル構築に推奨される特徴量と前処理方法を提案する
  - _要件: 11.1, 11.2, 11.3, 11.4, 11.5_

- [x] 11.1 プロパティテストを実装: クラス分離度の非負性
  - **プロパティ22: クラス分離度の非負性**
  - **検証: 要件 11.4**

- [x] 11.2 ユニットテストを実装: FaultLevelAnalyzer
  - tests/unit/test_fault_level_analyzer.pyファイルを作成する
  - 故障レベル識別機能のテストを実装する

- [x] 12. PreprocessingRecommenderの実装
  - src/nasa_pcoe_eda/preprocessing/recommender.pyファイルを作成する
  - recommend_missing_value_strategy()メソッドを実装し、欠損値処理方法を推奨する
  - recommend_scaling()メソッドを実装し、スケーリング方法を推奨する
  - suggest_feature_engineering()メソッドを実装し、派生特徴量を提案する
  - recommend_data_split()メソッドを実装し、時系列を考慮したデータ分割方法を提案する
  - 前処理パイプラインを順序付きリストとして提供する
  - _要件: 12.1, 12.2, 12.3, 12.4, 12.5_

- [x] 12.1 プロパティテストを実装: スケーリング推奨の論理性
  - **プロパティ24: スケーリング推奨の論理性**
  - **検証: 要件 12.2**

- [x] 12.2 プロパティテストを実装: 前処理推奨の完全性
  - **プロパティ23: 前処理推奨の完全性**
  - **検証: 要件 12.5**

- [x] 12.3 ユニットテストを実装: PreprocessingRecommender
  - tests/unit/test_preprocessing_recommender.pyファイルを作成する
  - 前処理推奨機能のテストを実装する

- [x] 13. ReportGeneratorの実装
  - src/nasa_pcoe_eda/reporting/generator.pyファイルを作成する
  - src/nasa_pcoe_eda/reporting/templates/ディレクトリを作成し、HTMLレポートテンプレートを作成する
  - generate_report()メソッドを実装し、包括的なレポートを生成する
  - create_summary_section()メソッドを実装し、データセット概要を作成する
  - create_statistics_section()メソッドを実装し、統計情報を作成する
  - create_recommendations_section()メソッドを実装し、RUL/故障診断の推奨事項を作成する
  - レポートに全ての統計、可視化、推奨事項を含める
  - 生成されたレポートファイルのパスを返す
  - _要件: 7.1, 7.2, 7.4, 7.5_

- [x] 13.1 プロパティテストを実装: レポート生成の完全性
  - **プロパティ14: レポート生成の完全性**
  - **検証: 要件 7.2**

- [x] 13.2 プロパティテストを実装: レポート出力通知
  - **プロパティ15: レポート出力通知**
  - **検証: 要件 7.5**

- [x] 13.3 ユニットテストを実装: ReportGenerator
  - tests/unit/test_report_generator.pyファイルを作成する
  - レポート生成機能のテストを実装する

- [x] 14. Analysis Orchestratorの実装
  - src/nasa_pcoe_eda/orchestrator.pyファイルを作成する
  - 全てのアナライザーを統合するオーケストレーターを実装する
  - データ読み込みから分析、可視化、レポート生成までの完全なパイプラインを実装する
  - エラーハンドリングとログ記録を実装する
  - 分析結果をAnalysisResultsデータクラスに集約する
  - _要件: 全要件の統合_

- [x] 14.1 ユニットテストを実装: Analysis Orchestrator
  - tests/unit/test_orchestrator.pyファイルを作成する
  - オーケストレーター機能のテストを実装する

- [x] 15. チェックポイント - 全てのテストが通ることを確認
  - 全てのテストが通ることを確認し、問題があればユーザーに質問する

- [x] 16. CLIインターフェースの実装
  - src/nasa_pcoe_eda/cli.pyファイルを作成する
  - pyproject.tomlにCLIエントリーポイントを追加する
  - コマンドライン引数を解析する機能を実装する
  - データセットパス、出力ディレクトリ等のオプションをサポートする
  - 進捗状況を表示する機能を実装する
  - エラーメッセージをユーザーフレンドリーに表示する
  - _要件: 全要件_

- [x] 16.1 統合テストを実装: 完全なEDAパイプライン
  - tests/integration/test_full_pipeline.pyファイルを作成する
  - データ読み込みからレポート生成までの全フローをテストする
  - 実際のNASA PCOEデータセットNo.12を使用する

- [x] 16.2 統合テストを実装: RUL分析ワークフロー
  - tests/integration/test_rul_workflow.pyファイルを作成する
  - 劣化特徴量の識別からRUL推奨特徴量リスト生成までをテストする

- [x] 16.3 統合テストを実装: 故障診断ワークフロー
  - tests/integration/test_fault_workflow.pyファイルを作成する
  - 故障レベル識別から前処理推奨生成までをテストする

- [x] 17. Jupyter Notebookの作成
  - notebooks/exploratory_analysis.ipynbファイルを作成する
  - 探索的分析用のサンプルノートブックを作成する
  - 各コンポーネントの使用例を含める
  - NASA PCOE Dataset No.12を使用した実例を含める
  - 可視化結果を含める
  - _要件: 全要件_

- [x] 18. ドキュメントの完成
  - README.mdを更新し、インストール手順と使用方法を詳細に記載する
  - 各モジュールのdocstringを完成させる
  - 使用例とサンプルコードを追加する
  - NASA PCOE Dataset No.12のダウンロード方法を記載する
  - _要件: 全要件_

- [x] 19. 最終チェックポイント - 全てのテストが通ることを確認
  - 全てのテストが通ることを確認し、問題があればユーザーに質問する
  - **完了**: 全テストスイートが正常に実行完了
    - 全テスト: 300 passed, 290 warnings
    - プロパティベーステスト: 26 passed
    - ユニットテスト: 242 passed  
    - 統合テスト: 32 passed
    - **警告詳細分析結果**:
      - 日本語フォント不足 (matplotlib): 285件 (98.3%) - 表示のみの問題、機能に影響なし
      - 非推奨警告 (DeprecationWarning): 3件 (1.0%) - japanize-matplotlib, setuptools関連
      - 実行時警告 (RuntimeWarning): 2件 (0.7%) - 統計計算関連の情報警告
      - 全ての警告は機能に影響せず、システムは完全に動作可能

- [x] 19.1 警告対策の実装
  - **日本語フォント不足警告の抑制対策を実装する**：
    - src/nasa_pcoe_eda/visualization/engine.pyに警告フィルター機能を追加
    - matplotlibの日本語フォント警告を適切に抑制する設定を実装
    - 環境変数やコンフィグファイルでの警告制御オプションを追加
  - **テスト実行時の警告制御を実装する**：
    - pytest.iniファイルを作成し、既知の無害な警告をフィルタリング
    - 日本語フォント関連警告の抑制設定を追加
    - 非推奨警告の適切な分類とフィルタリング
  - **警告レポート機能の実装**：
    - 新しい警告や重要な警告のみを表示する仕組みを構築
    - 警告カテゴリ別の集計・レポート機能を追加
    - CI/CD環境での警告管理を改善
  - **ドキュメント更新**：
    - README.mdに警告対策の説明を追加
    - 開発者向けの警告管理ガイドを作成
  - 実装後、テストスイートを再実行して警告数の大幅削減を確認する
  - _要件: 開発効率向上、テスト実行時の視認性改善_

- [x] 20. 劣化応答性分析Jupyter Notebookの作成
  - notebooks/degradation_response_analysis.ipynbファイルを作成する
  - **同一個体への同一入力に対する出力応答の変化を詳細分析・可視化する**：
    - 特定のコンデンサ（例：ES12C1）を選択し、全サイクルを通した分析を実施
    - 同一周波数（例：1Hz, 10Hz, 100Hz, 1kHz）での交流信号入力に対する応答変化を追跡
    - **インピーダンス応答の変化**：各サイクルでの同一周波数に対するインピーダンス値の変化をプロット
    - **位相応答の変化**：各サイクルでの同一周波数に対する位相角の変化をプロット
    - **応答性劣化の定量化**：
      - 応答時間の遅延（位相遅れの増加）を測定・可視化
      - 振幅の減少（インピーダンス変化）を測定・可視化
      - 初期値からの変化率を％で表示
    - **劣化トレンドの統計分析**：
      - 各周波数での劣化速度（変化率/サイクル）を計算
      - 線形回帰による劣化トレンド分析（R²値、傾き）
      - 劣化の非線形性検出（変化点分析）
    - **複数周波数での比較分析**：
      - 低周波数 vs 高周波数での劣化パターンの違いを可視化
      - 周波数依存性の劣化特性を分析
    - **故障予兆検出**：
      - 急激な変化点（異常値）の検出と可視化
      - 劣化加速ポイントの特定
  - 各可視化に適切な日本語ラベル、凡例、統計情報を追加する
  - 分析結果の解釈とコメントを含める
  - _要件: 4.2, 10.3, 10.4, 実データを用いた劣化プロセスの詳細理解_

- [x] 21. 実データ（ES12.mat）の構造解析と読み込み機能の実装
  - **実データファイル構造の詳細解析**：
    - ES12.matファイルの内部構造を調査・分析する
    - MATLAB v7.3形式（HDF5）の階層構造を把握する
    - 各コンデンサ（ES12C1～ES12C8）のデータ配置を確認する
    - EIS（電気化学インピーダンス分光）データの形式を理解する
    - 測定周波数、サイクル数、測定項目（容量、ESR、インピーダンス、位相）を特定する
  - **実データ読み込み機能の実装**：
    - h5pyを使用したES12.matファイルの正確な読み込み機能を実装する
    - 各コンデンサのデータを適切に抽出・整理する機能を実装する
    - サンプルデータと同じ形式に変換する機能を実装する
    - データの欠損値や異常値を検出・処理する機能を実装する
  - **データ変換・正規化機能の実装**：
    - 実データをノートブック分析用の統一フォーマットに変換する
    - 測定単位の統一と正規化を実装する
    - サイクル番号とタイムスタンプの対応付けを実装する
  - _要件: 2.1, 2.3, 実データの正確な読み込みと処理_

- [x] 21.1 プロパティテストを実装: 実データ読み込みの完全性
  - **プロパティ25: 実データ読み込みの完全性**
  - **検証: 要件 2.1, 2.3**
  - 実データの全コンデンサ・全サイクル・全周波数データが正確に読み込まれることを検証

- [x] 22. 劣化応答性分析ノートブックの実データ対応
  - **ノートブックの実データ読み込み機能を実装**：
    - create_detailed_eis_sample_data()関数を拡張し、実データ読み込みに対応
    - 実データが存在する場合の処理フローを実装
    - 実データとサンプルデータの自動切り替え機能を実装
  - **実データ特有の問題への対応**：
    - 実データの欠損値・異常値処理を実装
    - 測定ノイズのフィルタリング機能を実装
    - データ品質チェック機能を実装
  - **実データでの分析精度向上**：
    - 実際の劣化パターンに基づく分析アルゴリズムの調整
    - 統計的手法の最適化（外れ値検出、トレンド分析）
    - 可視化の改善（実データの特性に合わせた表示）
  - **実データ分析結果の検証**：
    - サンプルデータとの比較分析
    - 実データから得られる新たな知見の抽出
    - 分析手法の妥当性検証
  - _要件: 4.2, 10.3, 10.4, 実データを用いた高精度分析_

- [x] 22.1 プロパティテストを実装: 実データ分析の一貫性
  - **プロパティ26: 実データ分析の一貫性**
  - **検証: 要件 4.2, 10.3**
  - 実データとサンプルデータで同じ分析手法が一貫した結果を出力することを検証

- [x] 23. 実データ統合テストの実装
  - **完全な実データパイプラインテスト**：
    - tests/integration/test_real_data_pipeline.pyファイルを作成
    - ES12.matファイルを使用した完全なデータ処理パイプラインをテスト
    - データ読み込み→分析→可視化→レポート生成の全フローを検証
  - **実データ品質検証テスト**：
    - 実データの整合性・完全性を検証するテストを実装
    - 各コンデンサのデータ品質を評価するテストを実装
    - 測定データの物理的妥当性を検証するテストを実装
  - **実データ vs サンプルデータ比較テスト**：
    - 同じ分析手法での結果比較テストを実装
    - 分析精度・信頼性の比較評価を実装
    - パフォーマンス比較テストを実装
  - _要件: 全要件の実データでの検証_

- [x] 23.2 テスト実行速度とWarning対策の実装
  - **Warning大幅削減対策**：
    - 日本語フォント警告（1200+件）の抑制：pytest.iniとmatplotlib設定で日本語フォント警告をフィルタリング
    - 統計計算警告（RuntimeWarning）の適切な処理：scipy.statsの精度警告を抑制
    - 非推奨警告（DeprecationWarning）の分類とフィルタリング
  - **テスト実行速度改善**：
    - プロパティベーステストのmax_examples削減（現在3→1に調整）
    - 統合テストでの可視化生成を最小限に制限（テスト用軽量モード実装）
    - 並行処理テストの最適化（スレッド数削減、タイムアウト調整）
  - **テスト設定最適化**：
    - pytest.iniでwarning filterを設定し、既知の無害警告を抑制
    - テスト専用のmatplotlib backend設定（'Agg'モード強制）
    - メモリ使用量監視とガベージコレクション最適化
  - **目標**：
    - Warning数を1200+件から50件以下に削減
    - テスト実行時間を2分20秒から30秒以下に短縮
    - テスト結果の視認性を大幅改善
  - _要件: 開発効率向上、CI/CD最適化_

- [x] 23.1 プロパティテストを実装: 実データ処理の堅牢性
  - **プロパティ27: 実データ処理の堅牢性**
  - **検証: 要件 2.4, 8.1**
  - 実データの様々な品質状態（欠損値、ノイズ等）に対して処理が堅牢であることを検証

- [x] 24. 実データ分析レポートの生成と検証
  - **実データ専用レポートテンプレートの作成**：
    - 実データの特性を反映したレポートテンプレートを作成
    - 実測データの信頼性・精度情報を含むレポート形式を実装
    - 実データ vs 理論値の比較分析セクションを追加
  - **実データ分析結果の文書化**：
    - 実データから得られた劣化パターンの詳細分析結果を文書化
    - 各コンデンサの個体差・劣化特性の比較レポートを生成
    - 実用的な故障予測・保全指針の提案を含むレポートを作成
  - **分析手法の妥当性検証レポート**：
    - 実データでの分析手法の有効性を検証・文書化
    - サンプルデータとの比較による手法の信頼性評価
    - 今後の改善点・拡張可能性の提案を含む
  - _要件: 7.1, 7.2, 7.4, 7.5, 実データに基づく包括的レポート_

- [x] 25. チェックポイント - 実データ対応の完全性確認
  - 実データ（ES12.mat）を使用した全機能の動作確認
  - 実データ読み込み→分析→可視化→レポート生成の完全なフロー検証
  - 実データ特有の問題（欠損値、ノイズ、異常値）への対応確認
  - サンプルデータとの比較による分析精度・信頼性の評価
  - 全ての実データ関連テストが通ることを確認
  - 問題があればユーザーに質問し、解決策を実装する
  - _要件: 実データを用いた完全なシステム検証_
